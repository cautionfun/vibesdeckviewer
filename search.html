<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <nav>
        <a href="index.html">Deck Viewer</a> |
        <a href="search.html">Card Search</a> |
        <a href="openpacks.html">Pack Simulator</a>
    </nav>
    <title>Vibes Card Search</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        input, label { font-size: 16px; }
        input[type="text"] { width: 100%; padding: 10px; margin: 5px 0; }
        fieldset { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
        legend { font-weight: bold; }
        .filters label { display: inline-block; margin-right: 10px; }
        .search-container { max-width: 600px; margin: 0 auto; padding: 1rem; }
        ul { list-style-type: none; padding: 0; }
        li { padding: 5px 0; }
        #cardPreview { position: absolute; pointer-events: none; max-width: 250px; max-height: 350px; display: none; border: 2px solid #ccc; background: white; z-index: 1000; }
        #searchName, #searchText { display: block; width: 100%; max-width: 100%; box-sizing: border-box; margin-bottom: 1rem; }
        h1, nav { text-align: center; }
        nav a { text-decoration: none; font-size: 16px; margin: 0 10px; }
    </style>
</head>
<body>
    <div class="search-container">
        <h1>Vibes Card Search</h1>
        <label for="searchName">Search card name:</label>
        <input type="text" id="searchName" placeholder="Enter card name..." oninput="searchCards()">
        
        <label for="searchText">Search card text:</label>
        <input type="text" id="searchText" placeholder="Enter search query..." oninput="searchCards()">

        <fieldset class="filters">
            <legend>Filter by Type:</legend>
            <label><input type="checkbox" class="filter-type" value="Penguin" onchange="searchCards()"> Penguin</label>
            <label><input type="checkbox" class="filter-type" value="Action" onchange="searchCards()"> Action</label>
            <label><input type="checkbox" class="filter-type" value="Relic" onchange="searchCards()"> Relic</label>
            <label><input type="checkbox" class="filter-type" value="Rod" onchange="searchCards()"> Rod</label>
            <label><input type="checkbox" class="filter-type" value="???" onchange="searchCards()"> ???</label>
        </fieldset>

        <fieldset class="filters">
            <legend>Filter by Color:</legend>
            <label><input type="checkbox" class="filter-color" value="Red" onchange="searchCards()"> Red</label>
            <label><input type="checkbox" class="filter-color" value="Blue" onchange="searchCards()"> Blue</label>
            <label><input type="checkbox" class="filter-color" value="Yellow" onchange="searchCards()"> Yellow</label>
            <label><input type="checkbox" class="filter-color" value="Green" onchange="searchCards()"> Green</label>
            <label><input type="checkbox" class="filter-color" value="Purple" onchange="searchCards()"> Purple</label>
            <label><input type="checkbox" class="filter-color" value="Colorless" onchange="searchCards()"> Colorless</label>
        </fieldset>

        <ul id="results"></ul>
        <img id="cardPreview" src="" alt="Card Preview">
    </div>
    <script>
        let cards = [];
    
        fetch('vibes_cards.json')
            .then(response => response.json())
            .then(data => {
                cards = data;
            })
            .catch(error => console.error('Error loading JSON:', error));

        function searchCards() {
            const queryText = document.getElementById('searchText').value.toLowerCase();
            const queryName = document.getElementById('searchName').value.toLowerCase();
            const selectedTypes = Array.from(document.querySelectorAll('.filter-type:checked')).map(cb => cb.value);
            const selectedColors = Array.from(document.querySelectorAll('.filter-color:checked')).map(cb => cb.value);
            const resultsList = document.getElementById('results');
            resultsList.innerHTML = '';
    
            if (!queryText && !queryName && selectedTypes.length === 0 && selectedColors.length === 0) return;
    
            const filteredCards = cards.filter(card => {
                const matchesText = queryText && card.cardText && card.cardText.toLowerCase().includes(queryText);
                const matchesName = queryName && card.name.toLowerCase().includes(queryName);
                const matchesType = selectedTypes.length === 0 || selectedTypes.includes(card.type);
                const matchesColor = selectedColors.length === 0 || selectedColors.includes(card.color);
    
                return (matchesText || matchesName) && matchesType && matchesColor;
            });
    
            filteredCards.forEach(card => {
                const li = document.createElement('li');
                li.textContent = card.name;
    
                li.addEventListener('mouseover', () => {
                    showCardImage(card.id, li);
                });
                li.addEventListener('mouseout', () => {
                    hideCardImage();
                });
    
                resultsList.appendChild(li);
            });
        }
    
        function showCardImage(cardId, li) {
            const img = document.getElementById('cardPreview');
            img.style.display = 'block';
            img.src = `vibes_card_images/${cardId}.png`;

            img.onload = () => {
                positionCardImage(img, li);
            };
        }

        function positionCardImage(img, li) {
            const rect = li.getBoundingClientRect();
            const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            const offsetX = 69; 
            const imageHeight = img.offsetHeight || 350;

            const top = (rect.bottom + scrollTop) - imageHeight;
            const left = rect.width + offsetX;

            img.style.top = top + 'px';
            img.style.left = left + 'px';
        }

        function hideCardImage() {
            const img = document.getElementById('cardPreview');
            img.style.display = 'none';
            img.src = '';
        }
    </script>
</body>
</html>
